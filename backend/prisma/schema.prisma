// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid())
  username  String     @unique
  password  String
  createdAt DateTime   @default(now())
  
  categories Category[]
  expenses   Expense[]
  incomes    Income[]
  settings   UserSetting?
  assetTypes AssetType[]
  assets     Asset[]
  
  @@map("users")
}

enum CategoryType {
  EXPENSE
  INCOME
}

model Category {
  id       String       @id @default(uuid())
  name     String
  type     CategoryType
  parentId String?
  userId   String
  
  user     User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent   Category?  @relation("SubCategories", fields: [parentId], references: [id], onDelete: Cascade)
  children Category[] @relation("SubCategories")
  expenses Expense[]
  incomes  Income[]
  
  @@map("categories")
}

model Expense {
  id         String   @id @default(uuid())
  amount     Float
  date       DateTime
  note       String?
  categoryId String
  userId     String
  createdAt  DateTime @default(now())
  
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("expenses")
}

model Income {
  id         String   @id @default(uuid())
  amount     Float
  date       DateTime
  note       String?
  categoryId String
  userId     String
  createdAt  DateTime @default(now())
  
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("incomes")
}

enum Theme {
  LIGHT
  DARK
}

enum Currency {
  USD
  VND
}

model UserSetting {
  id        String   @id @default(uuid())
  userId    String   @unique
  theme     Theme    @default(LIGHT)
  language  String   @default("en")
  currency  Currency @default(USD)
  updatedAt DateTime @updatedAt
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("user_settings")
}

model AssetType {
  id          String   @id @default(uuid())
  name        String
  unit        String   // tael, usd, vnd, m2, etc.
  description String?
  userId      String
  createdAt   DateTime @default(now())
  
  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  assets Asset[]
  
  @@map("asset_types")
}

model Asset {
  id                String    @id @default(uuid())
  assetTypeId       String
  name              String
  quantity          Float
  purchasePrice     Float     @default(1)
  currentSellPrice  Float?
  purchaseDate      DateTime
  note              String?
  userId            String
  createdAt         DateTime  @default(now())
  
  assetType AssetType @relation(fields: [assetTypeId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("assets")
}
